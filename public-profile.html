<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Public Player Profile | AFNS Elite</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body{margin:0;font-family:Arial;background:#0b1220;color:white;}
.container{max-width:600px;margin:40px auto;padding:20px;background:#141c2f;border-radius:16px;}
h2{text-align:center;color:#00eaff;}
.card{background:#1a2438;padding:20px;border-radius:16px;}
.name{font-size:22px;font-weight:bold;color:#ffd34d;}
.stats{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:15px;}
.stat{background:#0c223f;padding:14px;border-radius:12px;text-align:center;}
.progress{background:#0c223f;border-radius:10px;overflow:hidden;height:10px;margin:12px 0;}
.progress-bar{height:100%;background:linear-gradient(90deg,#4db8ff,#ffd34d);width:0%;transition:.5s;}
</style>
</head>
<body>
<div class="container">
<h2>Public Profile</h2>
<div class="card">
  <div class="name" id="username">Loading...</div>
  <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
  <div class="stats">
    <div class="stat"><div>Rating</div><h3 id="rating">0</h3></div>
    <div class="stat"><div>Wins</div><h3 id="wins">0</h3></div>
    <div class="stat"><div>Losses</div><h3 id="losses">0</h3></div>
    <div class="stat"><div>Win Rate</div><h3 id="winRate">0%</h3></div>
  </div>
  <div id="tournaments" style="margin-top:15px;"></div>
</div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain:"afnsclub.firebaseapp.com",
  projectId:"afnsclub"
});
const db = firebase.firestore();

const params = new URLSearchParams(window.location.search);
const uid = params.get("uid");
if(!uid){document.getElementById("username").innerText="Invalid profile";}

db.collection("players").doc(uid).get().then(doc=>{
  if(!doc.exists){document.getElementById("username").innerText="Player not found"; return;}
  const d=doc.data();
  document.getElementById("username").innerText=d.username||"â€”";
  document.getElementById("rating").innerText=d.rating||1000;

  db.collection("matches").get().then(snap=>{
    let wins=0,losses=0,draws=0,tournaments=[];
    snap.forEach(m=>{
      const data=m.data();
      if(data.status!=="approved") return;
      if(data.player1===d.username || data.player2===d.username){
        const [s1,s2] = data.score.split("-").map(Number);
        if(s1===s2){draws++;}else{
          const isWin=(data.player1===d.username && s1>s2)||(data.player2===d.username && s2>s1);
          if(isWin) wins++; else losses++;
        }
        if(data.matchType==="tournament" && data.tournamentName && !tournaments.includes(data.tournamentName)) tournaments.push(data.tournamentName);
      }
    });
    const total=wins+losses+draws;
    document.getElementById("wins").innerText=wins;
    document.getElementById("losses").innerText=losses;
    document.getElementById("winRate").innerText=total?Math.round((wins/total)*100)+"%":"0%";
    document.getElementById("progressBar").style.width=(d.rating%500)/5+"%";

    if(tournaments.length){
      const tDiv=document.getElementById("tournaments");
      tDiv.innerHTML="<strong>Tournaments:</strong> "+tournaments.join(", ");
    }
  });
});
</script>
</body>
</html>
