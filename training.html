<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>eFootball AI Training & Tips</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0; font-family:Arial,sans-serif; background:#0b1220; color:#fff;
}
header{background:#08112a; padding:15px; text-align:center; font-size:22px; color:#00eaff; font-weight:bold;}
.container{max-width:900px; margin:20px auto; padding:16px;}
.card{
  background:#141c2f; border-radius:12px; padding:16px; margin-bottom:12px; cursor:pointer; transition:0.3s; display:flex; align-items:center;
  box-shadow:0 2px 8px rgba(0,255,255,0.2),0 2px 4px rgba(255,215,0,0.2);
}
.card:hover{background:#1a2438; transform:translateY(-3px);}
.card img{width:50px; height:50px; margin-right:16px; border-radius:8px;}
.details{display:none; margin-top:10px; padding:10px; background:#0b1622; border-radius:8px; font-size:14px;}
input,textarea,button{width:100%; padding:12px; margin:6px 0; border-radius:8px; border:none; font-size:14px;}
input,textarea{background:#0b1220;color:#fff;}
button{background:#00eaff;color:#000;font-weight:bold;cursor:pointer; transition:0.2s;}
button:hover{background:#00c4e0;}
button.secondary{background:#1a1a1a;color:#ccc;}
.msg{margin-top:6px;font-size:14px;}
.hidden{display:none;}
.history-box{background:#0c1b2d; padding:10px; border-radius:8px; margin-top:10px;}
.history-box p{margin:6px 0; font-size:13px;}
</style>
</head>
<body>

<header>eFootball AI Training & Tips</header>

<div class="container" id="authBox">
  <h3>লগইন / সাইন আপ</h3>
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">লগইন</button>
  <button onclick="signup()">সাইন আপ</button>
  <div id="authMsg" class="msg"></div>
</div>

<div class="container hidden" id="mainBox">
  <div style="text-align:right;margin-bottom:10px;">
    <span id="userEmail"></span>
    <button onclick="logout()" style="width:auto;">লগআউট</button>
  </div>

  <h2>Training Categories</h2>
  <div id="categories"></div>

  <h2 style="margin-top:20px;">আপনার সমস্যা লিখুন</h2>
  <textarea id="playerProblem" placeholder="উদাহরণ: 'আমি গেমে গোল করতে পারছি না'"></textarea>
  <button onclick="getAIAnswer()">AI সমাধান দেখুন</button>
  <div id="aiAnswer" class="msg"></div>

  <h2 style="margin-top:20px;">আপনার পূর্ববর্তী সমস্যার সমাধান</h2>
  <div id="historyBox"></div>
</div>

<script>
// ---------------- FIREBASE ----------------
firebase.initializeApp({
  apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain:"afnsclub.firebaseapp.com",
  projectId:"afnsclub"
});
const auth = firebase.auth();
const db   = firebase.firestore();

// ---------------- AUTH ----------------
auth.onAuthStateChanged(user=>{
  if(user){
    document.getElementById("authBox").classList.add("hidden");
    document.getElementById("mainBox").classList.remove("hidden");
    document.getElementById("userEmail").innerText = user.email;
    loadCategories();
    loadHistory(user.uid);
  } else {
    document.getElementById("authBox").classList.remove("hidden");
    document.getElementById("mainBox").classList.add("hidden");
  }
});

function login(){
  const email=document.getElementById("email").value.trim();
  const pass=document.getElementById("password").value.trim();
  if(!email||!pass){document.getElementById("authMsg").innerText="সব তথ্য দিন"; return;}
  auth.signInWithEmailAndPassword(email,pass)
    .then(()=>{document.getElementById("authMsg").innerText="সফল লগইন!";})
    .catch(e=>{document.getElementById("authMsg").innerText=e.message;});
}

function signup(){
  const email=document.getElementById("email").value.trim();
  const pass=document.getElementById("password").value.trim();
  if(!email||!pass){document.getElementById("authMsg").innerText="সব তথ্য দিন"; return;}
  auth.createUserWithEmailAndPassword(email,pass)
    .then(()=>{document.getElementById("authMsg").innerText="সাইনআপ সফল!";})
    .catch(e=>{document.getElementById("authMsg").innerText=e.message;});
}

function logout(){auth.signOut();}

// ---------------- LOAD TRAINING ----------------
async function loadCategories(){
  const container=document.getElementById("categories");
  container.innerHTML="লোড হচ্ছে...";

  const categories=[
    {name:"ড্রিবলিং", img:"https://img.icons8.com/color/96/000000/soccer-ball.png"},
    {name:"শুটিং", img:"https://img.icons8.com/color/96/000000/goal.png"},
    {name:"পাসিং", img:"https://img.icons8.com/color/96/000000/passing.png"},
    {name:"ডিফেন্স", img:"https://img.icons8.com/color/96/000000/defense.png"},
    {name:"কৌশল", img:"https://img.icons8.com/color/96/000000/tactics.png"},
    {name:"সেট-পিস", img:"https://img.icons8.com/color/96/000000/free-kick.png"},
    {name:"ফিটনেস", img:"https://img.icons8.com/color/96/000000/fitness.png"},
    {name:"মেন্টাল মাইন্ডসেট", img:"https://img.icons8.com/color/96/000000/mind.png"}
  ];
  container.innerHTML="";
  categories.forEach(cat=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`<img src="${cat.img}" alt="${cat.name}"><div><b>${cat.name}</b><div class="details">AI থেকে লোড হচ্ছে...</div></div>`;
    card.onclick=()=>{card.querySelector(".details").classList.toggle("details");};
    container.appendChild(card);

    fetchAITip(cat.name).then(tip=>{
      card.querySelector(".details").innerHTML = tip;
    });
  });
}

// ---------------- AI SIMULATION ----------------
async function fetchAITip(category){
  const tips={
    "ড্রিবলিং":"প্রতিপক্ষকে পালানোর জন্য কনসিস্টেন্ট ড্রিবলিং ড্রিল করুন। 1v1 পরিস্থিতিতে দক্ষতা বাড়ান।",
    "শুটিং":"শট অনুশীলন করুন, বলের গতি ও লক্ষ্য ঠিক রাখুন। লং শট ও ফাইনাল শট প্র্যাকটিস করুন।",
    "পাসিং":"দ্রুত এবং সঠিক পাস দিন। One-Touch পাস ও Through Pass প্র্যাকটিস করুন।",
    "ডিফেন্স":"পজিশনিং এবং টাইমিং শিখুন। ট্র্যাকিং এবং ব্লকিং প্র্যাকটিস করুন।",
    "কৌশল":"দলগত সমন্বয় বজায় রাখুন। Offensive ও Defensive Tactics শিখুন।",
    "সেট-পিস":"ফ্রি-কিক, কর্নার এবং পেনাল্টি পরিকল্পিতভাবে প্র্যাকটিস করুন।",
    "ফিটনেস":"স্ট্যামিনা, স্প্রিন্ট ও এজিলিটি বাড়ান। নিয়মিত ফিটনেস অনুশীলন।",
    "মেন্টাল মাইন্ডসেট":"চাপ সামলানো শিখুন। ফোকাস ধরে রাখুন, ম্যাচের সময় আত্মবিশ্বাস বাড়ান।"
  };
  return new Promise(resolve=>{
    setTimeout(()=>{resolve(tips[category] || "এই বিভাগের জন্য কোনো তথ্য পাওয়া যায়নি");},500);
  });
}

// ---------------- AI PLAYER PROBLEM ----------------
async function getAIAnswer(){
  const problem=document.getElementById("playerProblem").value.trim();
  const user = auth.currentUser;
  if(!problem){document.getElementById("aiAnswer").innerText="প্রথমে সমস্যা লিখুন"; return;}
  if(!user){document.getElementById("aiAnswer").innerText="লগইন করুন"; return;}
  
  document.getElementById("aiAnswer").innerText="AI বিশ্লেষণ হচ্ছে...";

  const OPENAI_KEY="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";

  try{
    const response = await fetch("https://api.openai.com/v1/chat/completions",{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization":`Bearer ${OPENAI_KEY}`
      },
      body: JSON.stringify({
        model:"gpt-4",
        messages:[
          {role:"system", content:"You are an expert eFootball coach. Answer in Bangla and give tactical tips."},
          {role:"user", content:`Player problem: ${problem}`}
        ],
        max_tokens:400
      })
    });
    const data = await response.json();
    const answer = data.choices[0].message.content;
    document.getElementById("aiAnswer").innerText=answer;

    // ---------------- SAVE HISTORY ----------------
    await db.collection("players").doc(user.uid).collection("history").add({
      problem: problem,
      answer: answer,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
    loadHistory(user.uid);

  }catch(err){
    console.error(err);
    document.getElementById("aiAnswer").innerText="AI উত্তর আনতে সমস্যা হয়েছে, পরে চেষ্টা করুন।";
  }
}

// ---------------- LOAD HISTORY ----------------
async function loadHistory(uid){
  const historyBox=document.getElementById("historyBox");
  historyBox.innerHTML="লোড হচ্ছে...";
  const snapshot = await db.collection("players").doc(uid).collection("history").orderBy("timestamp","desc").get();
  if(snapshot.empty){historyBox.innerHTML="কোনো পূর্ববর্তী সমস্যা নেই।"; return;}
  historyBox.innerHTML="";
  snapshot.forEach(doc=>{
    const data = doc.data();
    const div = document.createElement("div");
    div.className="history-box";
    div.innerHTML=`<p><b>সমস্যা:</b> ${data.problem}</p>
                   <p><b>AI সমাধান:</b> ${data.answer}</p>
                   <p style="font-size:11px;color:#ccc;">${data.timestamp?.toDate().toLocaleString() || ''}</p>`;
    historyBox.appendChild(div);
  });
}
</script>

</body>
</html>
