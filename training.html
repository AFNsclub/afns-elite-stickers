<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>eFootball AI Premium Training & Tips</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0; font-family:Arial,sans-serif; background:#0b1220; color:#fff;}
header{background:#08112a; padding:15px; text-align:center; font-size:24px; color:#00eaff; font-weight:bold;}
.container{max-width:900px; margin:20px auto; padding:16px;}
.card{background:#141c2f; border-radius:12px; padding:16px; margin-bottom:12px; cursor:pointer; transition:0.3s;}
.card:hover{background:#1a2438;}
.details{display:none; margin-top:10px; padding:10px; background:#0b1622; border-radius:8px; font-size:14px;}
input,textarea,button{width:100%; padding:12px; margin:6px 0; border-radius:8px; border:none; font-size:14px;}
input,textarea{background:#0b1220;color:#fff;}
button{background:#00eaff;color:#000;font-weight:bold;cursor:pointer; transition:0.2s;}
button:hover{background:#00c4e0;}
.msg{margin-top:6px;font-size:14px;}
.hidden{display:none;}
.history-box{background:#0c1b2d; padding:10px; border-radius:8px; margin-top:10px;}
.history-box p{margin:6px 0; font-size:13px;}
.ai-card{background:#0c1b2d; padding:12px; border-radius:10px; margin-top:10px;}
</style>
</head>
<body>

<header>eFootball AI Premium Training & Tips</header>

<div class="container" id="authBox">
  <h3>লগইন / সাইন আপ</h3>
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">লগইন</button>
  <button onclick="signup()">সাইন আপ</button>
  <div id="authMsg" class="msg"></div>
</div>

<div class="container hidden" id="mainBox">
  <div style="text-align:right;margin-bottom:10px;">
    <span id="userEmail"></span>
    <button onclick="logout()" style="width:auto;">লগআউট</button>
  </div>

  <h2>Training Categories</h2>
  <div id="categories"></div>

  <h2 style="margin-top:20px;">আপনার সমস্যা লিখুন</h2>
  <textarea id="playerProblem" placeholder="উদাহরণ: 'আমি গেমে গোল করতে পারছি না'"></textarea>
  <button onclick="getAIAnswer()">AI সমাধান দেখুন</button>
  <div id="aiAnswer" class="msg"></div>

  <h2 style="margin-top:20px;">আপনার পূর্ববর্তী সমস্যার সমাধান</h2>
  <div id="historyBox"></div>
</div>

<script>
// ---------------- FIREBASE ----------------
firebase.initializeApp({
  apiKey:"YOUR_FIREBASE_API_KEY",
  authDomain:"YOUR_FIREBASE_AUTH_DOMAIN",
  projectId:"YOUR_FIREBASE_PROJECT_ID"
});
const auth = firebase.auth();
const db   = firebase.firestore();

// ---------------- AUTH ----------------
auth.onAuthStateChanged(user=>{
  if(user){
    document.getElementById("authBox").classList.add("hidden");
    document.getElementById("mainBox").classList.remove("hidden");
    document.getElementById("userEmail").innerText = user.email;
    loadCategories();
    loadHistory(user.uid);
  } else {
    document.getElementById("authBox").classList.remove("hidden");
    document.getElementById("mainBox").classList.add("hidden");
  }
});

function login(){
  const email=document.getElementById("email").value.trim();
  const pass=document.getElementById("password").value.trim();
  if(!email||!pass){document.getElementById("authMsg").innerText="সব তথ্য দিন"; return;}
  auth.signInWithEmailAndPassword(email,pass)
    .then(()=>{document.getElementById("authMsg").innerText="সফল লগইন!";})
    .catch(e=>{document.getElementById("authMsg").innerText=e.message;});
}

function signup(){
  const email=document.getElementById("email").value.trim();
  const pass=document.getElementById("password").value.trim();
  if(!email||!pass){document.getElementById("authMsg").innerText="সব তথ্য দিন"; return;}
  auth.createUserWithEmailAndPassword(email,pass)
    .then(()=>{document.getElementById("authMsg").innerText="সাইনআপ সফল!";})
    .catch(e=>{document.getElementById("authMsg").innerText=e.message;});
}

function logout(){auth.signOut();}

// ---------------- LOAD TRAINING ----------------
async function loadCategories(){
  const container=document.getElementById("categories");
  container.innerHTML="লোড হচ্ছে...";

  const categories=[
    {name:"ড্রিবলিং", tip:"1v1 ড্রিল প্র্যাকটিস করুন।"},
    {name:"শুটিং", tip:"লক্ষ্য ঠিক রাখুন, শট অনুশীলন করুন।"},
    {name:"পাসিং", tip:"দ্রুত এবং সঠিক পাস দিন।"},
    {name:"ডিফেন্স", tip:"পজিশনিং এবং ব্লকিং অনুশীলন করুন।"},
    {name:"কৌশল", tip:"দলগত সমন্বয় বজায় রাখুন।"},
    {name:"সেট-পিস", tip:"ফ্রি-কিক, কর্নার প্র্যাকটিস করুন।"},
    {name:"ফিটনেস", tip:"স্ট্যামিনা এবং এজিলিটি বাড়ান।"},
    {name:"মেন্টাল মাইন্ডসেট", tip:"ফোকাস এবং আত্মবিশ্বাস উন্নত করুন।"}
  ];
  container.innerHTML="";
  categories.forEach(cat=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`<b>${cat.name}</b>
      <div class="details"><p>${cat.tip}</p></div>`;
    card.onclick=()=>{card.querySelector(".details").classList.toggle("details");};
    container.appendChild(card);
  });
}

// ---------------- AI PLAYER PROBLEM ----------------
async function getAIAnswer(){
  const problem = document.getElementById("playerProblem").value.trim();
  const user = auth.currentUser;
  if(!problem){document.getElementById("aiAnswer").innerText="প্রথমে সমস্যা লিখুন"; return;}
  if(!user){document.getElementById("aiAnswer").innerText="লগইন করুন"; return;}

  const aiAnswerDiv = document.getElementById("aiAnswer");
  aiAnswerDiv.innerHTML = "AI বিশ্লেষণ হচ্ছে...";

  try {
    const response = await fetch("https://afns-elite-stickers.onrender.com/ask-ai", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ problem })
    });
    const data = await response.json();
    const answer = data.answer;

    const aiCard = document.createElement("div");
    aiCard.className = "ai-card";
    aiCard.innerHTML = `<b>AI সমাধান:</b><p>${answer}</p>`;
    aiAnswerDiv.innerHTML = "";
    aiAnswerDiv.appendChild(aiCard);

    await db.collection("players").doc(user.uid).collection("history").add({
      problem,
      answer,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
    loadHistory(user.uid);

  } catch(err) {
    console.error(err);
    aiAnswerDiv.innerText = "AI উত্তর আনতে সমস্যা হয়েছে, পরে চেষ্টা করুন।";
  }
}

// ---------------- LOAD HISTORY ----------------
async function loadHistory(uid){
  const historyBox=document.getElementById("historyBox");
  historyBox.innerHTML="লোড হচ্ছে...";
  const snapshot = await db.collection("players").doc(uid).collection("history").orderBy("timestamp","desc").get();
  if(snapshot.empty){historyBox.innerHTML="কোনো পূর্ববর্তী সমস্যা নেই।"; return;}
  historyBox.innerHTML="";
  snapshot.forEach(doc=>{
    const data = doc.data();
    const div = document.createElement("div");
    div.className="history-box";
    div.innerHTML=`<p><b>সমস্যা:</b> ${data.problem}</p>
                   <p><b>AI সমাধান:</b> ${data.answer}</p>
                   <p style="font-size:11px;color:#ccc;">${data.timestamp?.toDate().toLocaleString() || ''}</p>`;
    historyBox.appendChild(div);
  });
}
</script>

</body>
</html>
