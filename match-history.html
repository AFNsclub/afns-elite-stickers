<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Match History</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{background:#0f172a;color:#fff;font-family:Arial}
.container{max-width:600px;margin:auto;padding:20px}
.card{background:#1e293b;padding:15px;border-radius:12px;margin-top:10px}
.win{border-left:6px solid #22c55e}
.loss{border-left:6px solid #ef4444}
.draw{border-left:6px solid #facc15}
.empty{text-align:center;margin-top:40px;opacity:.6}
</style>
</head>
<body>

<div class="container">
<h2>Match History</h2>
<div id="list"></div>
</div>

<script>
firebase.initializeApp({
apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
authDomain:"afnsclub.firebaseapp.com",
projectId:"afnsclub"
});

const auth=firebase.auth();
const db=firebase.firestore();

auth.onAuthStateChanged(user=>{
if(!user){location="login.html";return;}

const username=user.email.split("@")[0];

db.collection("matches")
.where("status","==","approved")
.orderBy("approvedAt","desc")
.onSnapshot(snap=>{

list.innerHTML="";
if(snap.empty){
list.innerHTML="<div class='empty'>No matches yet</div>";
return;
}

snap.forEach(doc=>{
const m=doc.data();
if(m.player1!==username&&m.player2!==username)return;

const [s1,s2]=m.score.split("-").map(Number);
let cls="draw",text="DRAW";

if(s1!==s2){
const win=(m.player1===username&&s1>s2)||(m.player2===username&&s2>s1);
cls=win?"win":"loss";
text=win?"WIN":"LOSS";
}

list.innerHTML+=`
<div class="card ${cls}">
<b>${text}</b><br>
${m.player1} âš” ${m.player2}<br>
Score: ${m.score}<br>
<small>${m.approvedAt?.toDate().toLocaleString()}</small>
</div>`;
});
});
});
</script>
</body>
</html>
