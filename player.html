<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Player Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(180deg,#020617,#020617);
      color: #e5e7eb;
    }
    .container {
      max-width: 420px;
      margin: auto;
      padding: 20px;
    }
    .motivation {
      text-align: center;
      color: #94a3b8;
      font-size: 14px;
      margin-bottom: 10px;
    }
    .avatar {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      background: #4f8cff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      font-weight: bold;
      margin: auto;
    }
    h2 {
      text-align: center;
      margin-top: 10px;
    }
    .card {
      background: #020617;
      border: 1px solid #1e293b;
      border-radius: 14px;
      padding: 16px;
      margin-top: 20px;
    }
    .row {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      font-size: 14px;
    }
    .divider {
      height: 1px;
      background: #1e293b;
      margin: 12px 0;
    }
    button {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: none;
      background: #4f8cff;
      color: white;
      font-size: 15px;
      margin-top: 12px;
    }
    input {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 10px;
      border: none;
      outline: none;
    }
  </style>
</head>
<body>

<div class="container">

  <!-- Motivation -->
  <p class="motivation" id="motivation">Play fair. Win together üèÜ</p>

  <!-- Avatar -->
  <div class="avatar" id="avatar">?</div>
  <h2 id="name">Loading...</h2>

  <!-- Info Card -->
  <div class="card">
    <div class="row"><span>Mobile</span><span id="mobile">-</span></div>
    <div class="row"><span>Email</span><span id="email">-</span></div>
    <div class="row"><span>Device</span><span id="device">-</span></div>
    <div class="row"><span>Game ID</span><span id="gameid">-</span></div>

    <div class="divider"></div>

    <div class="row"><span>Wins</span><span id="wins">0</span></div>
    <div class="row"><span>Loses</span><span id="loses">0</span></div>
    <div class="row"><span>Goals For</span><span id="gf">0</span></div>
    <div class="row"><span>Goals Against</span><span id="ga">0</span></div>
    <div class="row"><span>Goal Diff</span><span id="gd">0</span></div>
  </div>

  <button onclick="toggleEdit()">Edit Profile</button>

  <!-- Edit -->
  <div class="card" id="editBox" style="display:none;">
    <input id="editDevice" placeholder="Device Name">
    <input id="editGameId" placeholder="Game ID">
    <input id="editFb" placeholder="Facebook Profile Link">
    <button onclick="saveProfile()">Save Changes</button>
  </div>

</div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
    authDomain: "afnsclub.firebaseapp.com",
    projectId: "afnsclub",
    storageBucket: "afnsclub.firebasestorage.app",
    messagingSenderId: "1088089213558",
    appId: "1:1088089213558:web:bd5e01caaeecaa46bcad57"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const quotes = [
    "Play fair. Win together üèÜ",
    "Every match makes you stronger üí™",
    "Respect the game ‚öΩ",
    "Champions are made üî•",
    "Focus. Fight. Finish üöÄ"
  ];
  document.getElementById("motivation").innerText =
    quotes[Math.floor(Math.random() * quotes.length)];

  auth.onAuthStateChanged(user => {
    if (!user) {
      location.href = "login.html";
      return;
    }

    db.collection("players").doc(user.uid).get().then(doc => {
      if (!doc.exists) return;
      const d = doc.data();

      const playerName = d.name || d.username || "Player";

      document.getElementById("name").innerText = playerName;
      document.getElementById("avatar").innerText = playerName[0].toUpperCase();
      document.getElementById("mobile").innerText = d.mobile || "-";
      document.getElementById("email").innerText = d.email || "-";
      document.getElementById("device").innerText = d.device || "-";
      document.getElementById("gameid").innerText = d.gameId || "-";

      document.getElementById("wins").innerText = d.wins || 0;
      document.getElementById("loses").innerText = d.loses || 0;
      document.getElementById("gf").innerText = d.goalsFor || 0;
      document.getElementById("ga").innerText = d.goalsAgainst || 0;
      document.getElementById("gd").innerText =
        (d.goalsFor || 0) - (d.goalsAgainst || 0);

      document.getElementById("editDevice").value = d.device || "";
      document.getElementById("editGameId").value = d.gameId || "";
      document.getElementById("editFb").value = d.facebook || "";
    });
  });

  function toggleEdit() {
    const box = document.getElementById("editBox");
    box.style.display = box.style.display === "none" ? "block" : "none";
  }

  function saveProfile() {
    const user = auth.currentUser;
    if (!user) return;

    db.collection("players").doc(user.uid).update({
      device: document.getElementById("editDevice").value,
      gameId: document.getElementById("editGameId").value,
      facebook: document.getElementById("editFb").value
    }).then(() => {
      alert("Profile Updated");
      location.reload();
    });
  }
</script>

</body>
</html>
