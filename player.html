<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>AFN Player Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:Arial;background:#0f172a;color:#fff}
.container{max-width:600px;margin:auto;padding:20px}
.card{background:#1e293b;padding:20px;border-radius:15px}
.stat-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:15px}
.stat{background:#334155;padding:10px;border-radius:10px;text-align:center}
button{width:100%;padding:10px;margin-top:10px;border:none;border-radius:8px;font-weight:bold;background:#22d3ee}
.rank{margin:10px 0;padding:6px;border-radius:10px;background:#f59e0b;text-align:center}
.progress{background:#334155;height:8px;border-radius:10px;overflow:hidden}
.bar{height:100%;background:#22d3ee;width:0%}
</style>
</head>
<body>

<div class="container">
<div class="card">
<h2 id="username">Loading...</h2>
<div id="email"></div>
<div id="rank" class="rank">Unranked</div>

<div class="progress"><div id="bar" class="bar"></div></div>

<div class="stat-grid">
<div class="stat">Rating<br><b id="rating">0</b></div>
<div class="stat">Wins<br><b id="wins">0</b></div>
<div class="stat">Losses<br><b id="losses">0</b></div>
<div class="stat">Win Rate<br><b id="rate">0%</b></div>
</div>

<button onclick="location.href='match-history.html'">Match History</button>
<button onclick="logout()">Logout</button>

</div>
</div>

<script>
firebase.initializeApp({
apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
authDomain:"afnsclub.firebaseapp.com",
projectId:"afnsclub"
});

const auth=firebase.auth();
const db=firebase.firestore();

auth.onAuthStateChanged(async user=>{
if(!user){location="login.html";return;}

document.getElementById("email").innerText=user.email;
const uid=user.uid;
const ref=db.collection("players").doc(uid);

ref.onSnapshot(async snap=>{
if(!snap.exists){
await ref.set({
username:user.email.split("@")[0],
rating:1000,
wins:0,
losses:0,
draws:0
});
return;
}

const d=snap.data();
document.getElementById("username").innerText=d.username;
document.getElementById("rating").innerText=d.rating||1000;
document.getElementById("wins").innerText=d.wins||0;
document.getElementById("losses").innerText=d.losses||0;

const total=(d.wins||0)+(d.losses||0)+(d.draws||0);
const rate=total?Math.round((d.wins/total)*100):0;
document.getElementById("rate").innerText=rate+"%";

document.getElementById("bar").style.width=(d.rating%400)/4+"%";

document.getElementById("rank").innerText=
d.rating>=2000?"ðŸ‘‘ Legend":
d.rating>=1600?"ðŸ”¥ Elite":
d.rating>=1200?"â­ Pro":
d.rating>=900?"ðŸ¥‰ Rising":"Unranked";
});
});

function logout(){auth.signOut().then(()=>location="login.html");}
</script>
</body>
</html>
