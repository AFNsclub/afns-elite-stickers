<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>AFN Elite Player Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:radial-gradient(circle at top,#1a2f5c 0%,#0b1c33 40%,#1a0f1f 75%,#000 100%);
  color:#fff;
}
.container{max-width:700px;margin:auto;padding:20px;}
header{text-align:center;margin-bottom:20px;}
header img{width:90px;}
.card{
  background:linear-gradient(145deg,#0f2545,#081a2e);
  padding:20px;border-radius:22px;
  box-shadow:0 0 25px rgba(255,215,0,.15),0 0 40px rgba(0,120,255,.15);
}
.name{font-size:22px;font-weight:bold;color:#ffd34d;}
.email{opacity:.85;margin-bottom:8px;}
.rank-badge{
  display:inline-block;padding:6px 14px;border-radius:25px;
  background:linear-gradient(45deg,#ff3b3b,#ffae00);
  color:#fff;font-weight:bold;margin-top:6px;
}
.progress{background:#0c223f;border-radius:10px;overflow:hidden;height:10px;margin:12px 0;}
.progress-bar{height:100%;background:linear-gradient(90deg,#4db8ff,#ffd34d);width:0%;transition:.5s;}
.info-line{margin:8px 0;font-size:14px;}
.info-line span{color:#4db8ff;}
.stats{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:15px;}
.stat{
  background:linear-gradient(145deg,#132f55,#0d203a);
  padding:14px;border-radius:14px;text-align:center;
}
.stat h3{margin:5px 0;color:#ffd34d;}
button{
  width:100%;padding:12px;margin-top:10px;border:none;
  border-radius:12px;cursor:pointer;font-weight:bold;
  background:linear-gradient(45deg,#1e5eff,#00c6ff);
  color:#fff;
}
button.secondary{background:#1a1a1a;color:#ccc;}
.hidden{display:none;}
input{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none;}
.success{color:#00ff88;margin-top:10px;}
.fb-link{color:#4db8ff;text-decoration:underline;cursor:pointer;}
</style>
</head>

<body>
<div class="container">
<header>
  <img src="logo.png">
  <h2>AFN Elite Profile</h2>
</header>

<div class="card">
<div id="viewBox">
  <div class="name" id="v_username">Loading...</div>
  <div class="email" id="v_email">‚Äî</div>
  <div id="rankBadge" class="rank-badge">Unranked</div>

  <div class="progress">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <div class="info-line">üåê Facebook:
    <span id="fbLink" class="fb-link hidden" onclick="openFb()">View Profile</span>
  </div>

  <div class="info-line">üì± Phone: <span id="v_phone">‚Äî</span></div>
  <div class="info-line">üëë Owner ID: <span id="v_ownerId">‚Äî</span></div>
  <div class="info-line">üíª Device: <span id="v_device">‚Äî</span></div>

  <div class="stats">
    <div class="stat"><div>Rating</div><h3 id="rating">0</h3></div>
    <div class="stat"><div>Wins</div><h3 id="wins">0</h3></div>
    <div class="stat"><div>Losses</div><h3 id="losses">0</h3></div>
    <div class="stat"><div>Win Rate</div><h3 id="winRate">0%</h3></div>
  </div>

  <button onclick="location.href='player-submit-match.html'">Submit Match</button>
  <button onclick="location.href='match-history.html'">Match History</button>
  <button onclick="toggleEdit(true)">Edit Profile</button>
  <button class="secondary" onclick="logout()">Logout</button>
</div>

<div id="editBox" class="hidden">
  <input id="phone" placeholder="Phone">
  <input id="ownerId" placeholder="Owner ID">
  <input id="facebook" placeholder="Facebook link">
  <input id="deviceName" placeholder="Device name">
  <button onclick="saveProfile()">Save</button>
  <button class="secondary" onclick="toggleEdit(false)">Cancel</button>
</div>

<div id="msg"></div>
</div>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain: "afnsclub.firebaseapp.com",
  projectId: "afnsclub"
});

const auth = firebase.auth();
const db = firebase.firestore();
let uid, fbUrl="";

auth.onAuthStateChanged(async user=>{
  if(!user){
    location.replace("login.html");
    return;
  }

  uid = user.uid;
  document.getElementById("v_email").innerText = user.email;

  const docRef = db.collection("players").doc(uid);
  let docSnap = await docRef.get();

  if(!docSnap.exists){
    await docRef.set({
      username: user.email.split("@")[0],
      rating: 0,
      wins: 0,
      losses: 0,
      phone: "",
      ownerId: "",
      facebook: "",
      deviceName: ""
    });
    docSnap = await docRef.get();
  }

  const d = docSnap.data();

  document.getElementById("v_username").innerText = d.username || "‚Äî";
  document.getElementById("v_phone").innerText = d.phone || "‚Äî";
  document.getElementById("v_ownerId").innerText = d.ownerId || "‚Äî";
  document.getElementById("v_device").innerText = d.deviceName || "‚Äî";

  let r = d.rating || 0;
  document.getElementById("rating").innerText = r;
  document.getElementById("wins").innerText = d.wins || 0;
  document.getElementById("losses").innerText = d.losses || 0;

  let total = (d.wins||0)+(d.losses||0);
  document.getElementById("winRate").innerText =
    total ? Math.round((d.wins/total)*100)+"%" : "0%";

  document.getElementById("rankBadge").innerText =
    r>=2000?"üëë Legend":
    r>=1500?"üî• Elite":
    r>=1000?"‚≠ê Pro":
    r>=500?"ü•â Rising":"Unranked";

  document.getElementById("progressBar").style.width = (r%500)/5+"%";

  fbUrl = d.facebook || "";
  document.getElementById("fbLink").classList.toggle("hidden", !fbUrl);
});

function toggleEdit(edit){
  document.getElementById("viewBox").classList.toggle("hidden", edit);
  document.getElementById("editBox").classList.toggle("hidden", !edit);
}

function saveProfile(){
  db.collection("players").doc(uid).update({
    phone: document.getElementById("phone").value.trim(),
    ownerId: document.getElementById("ownerId").value.trim(),
    facebook: document.getElementById("facebook").value.trim(),
    deviceName: document.getElementById("deviceName").value.trim()
  }).then(()=>{
    document.getElementById("msg").innerHTML =
      "<div class='success'>Profile Updated</div>";
    toggleEdit(false);
    location.reload();
  });
}

function openFb(){
  if(fbUrl) window.open(fbUrl,"_blank");
}

function logout(){
  auth.signOut().then(()=>{
    location.replace("login.html");
  });
}
</script>

</body>
  </html>
