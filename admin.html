<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  background: #0b0b0b;
  color: #fff;
  font-family: Arial, sans-serif;
  padding: 20px;
}
h1, h2 {
  text-align: center;
}
.card {
  background: #1c1c1c;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 10px;
}
button {
  padding: 6px 12px;
  margin: 4px;
  cursor: pointer;
}
input {
  width: 100%;
  padding: 8px;
  margin: 6px 0;
}
#mainAdminBox {
  border: 1px solid #333;
  padding: 15px;
  border-radius: 10px;
  margin-top: 30px;
}
</style>
</head>

<body>

<h1>Admin Panel</h1>
<p id="roleInfo" style="text-align:center;"></p>

<div id="players"></div>

<!-- MAIN ADMIN CONTROLS -->
<div id="mainAdminBox" style="display:none;">
  <h2>Main Admin Controls</h2>

  <input id="adminUID" placeholder="Admin UID">
  <input id="adminEmail" placeholder="Admin Email">

  <button onclick="addAdmin()">‚ûï Add Admin</button>
  <button onclick="removeAdmin()">‚ùå Remove Admin</button>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* =========================
   üî• FIREBASE CONFIG (READY)
   ========================= */
const firebaseConfig = {
  apiKey: "AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain: "afnsclub.firebaseapp.com",
  projectId: "afnsclub",
  storageBucket: "afnsclub.firebasestorage.app",
  messagingSenderId: "1088089213558",
  appId: "1:1088089213558:web:bd5e01caaeecaa46bcad57"
};
/* ========================= */

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

let currentUID = "";
let currentRole = "";

/* =========================
   üîê ADMIN PROTECTION
   ========================= */
auth.onAuthStateChanged(async (user) => {
  if (!user) {
    location.href = "admin-login.html";
    return;
  }

  currentUID = user.uid;

  const adminDoc = await db.collection("admins").doc(currentUID).get();
  if (!adminDoc.exists) {
    alert("Access Denied");
    auth.signOut();
    location.href = "admin-login.html";
    return;
  }

  currentRole = adminDoc.data().role;
  document.getElementById("roleInfo").innerText = "Role: " + currentRole;

  if (currentRole === "main") {
    document.getElementById("mainAdminBox").style.display = "block";
  }

  loadPlayers();
});

/* =========================
   üë• LOAD PLAYERS + RANKING
   ========================= */
function loadPlayers() {
  db.collection("players")
    .orderBy("win", "desc")
    .orderBy("lose", "asc")
    .get()
    .then(snapshot => {
      const box = document.getElementById("players");
      box.innerHTML = "";

      let rank = 1;
      snapshot.forEach(doc => {
        const p = doc.data();
        box.innerHTML += `
          <div class="card">
            <b>#${rank} ${p.name || "No Name"}</b><br>
            Win: ${p.win || 0} | Lose: ${p.lose || 0}<br>
            <button onclick="updateScore('${doc.id}','win')">+ Win</button>
            <button onclick="updateScore('${doc.id}','lose')">+ Lose</button>
          </div>
        `;
        rank++;
      });
    });
}

/* =========================
   üèÜ WIN / LOSE UPDATE
   ========================= */
function updateScore(uid, type) {
  const ref = db.collection("players").doc(uid);

  if (type === "win") {
    ref.update({
      win: firebase.firestore.FieldValue.increment(1)
    });
  }

  if (type === "lose") {
    ref.update({
      lose: firebase.firestore.FieldValue.increment(1)
    });
  }

  setTimeout(loadPlayers, 500);
}

/* =========================
   üëë MAIN ADMIN FUNCTIONS
   ========================= */
function addAdmin() {
  if (currentRole !== "main") {
    alert("Only Main Admin allowed");
    return;
  }

  const uid = document.getElementById("adminUID").value;
  const email = document.getElementById("adminEmail").value;

  if (!uid || !email) {
    alert("UID & Email required");
    return;
  }

  db.collection("admins").doc(uid).set({
    email: email,
    role: "admin"
  }).then(() => {
    alert("Admin Added");
  });
}

function removeAdmin() {
  if (currentRole !== "main") {
    alert("Only Main Admin allowed");
    return;
  }

  const uid = document.getElementById("adminUID").value;
  if (!uid) {
    alert("UID required");
    return;
  }

  db.collection("admins").doc(uid).delete().then(() => {
    alert("Admin Removed");
  });
}
</script>

</body>
  </html>
