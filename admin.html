<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin – Player Control</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{
  margin:0;
  background:radial-gradient(circle at top,#0a1a4a,#050b1e 70%);
  color:#fff;
}
.header{
  padding:14px 18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:linear-gradient(180deg,#070f2a,#050b1e);
}
.header img{height:34px}
.header button{
  background:#ff4d4d;
  border:none;
  color:#fff;
  padding:8px 16px;
  border-radius:8px;
  cursor:pointer;
}
.container{
  max-width:1100px;
  margin:auto;
  padding:18px;
}
table{
  width:100%;
  border-collapse:collapse;
  background:rgba(255,255,255,.05);
  border-radius:14px;
  overflow:hidden;
}
th,td{
  padding:12px;
  font-size:14px;
  border-bottom:1px solid rgba(255,255,255,.08);
  text-align:center;
}
th{background:rgba(255,255,255,.08)}
tr:hover{background:rgba(255,255,255,.06)}
button.action{
  padding:6px 10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-size:13px;
}
.ban{background:#f59e0b;color:#000}
.unban{background:#22c55e;color:#000}
.del{background:#ef4444;color:#fff}
footer{
  text-align:center;
  font-size:12px;
  opacity:.5;
  margin:24px 0 12px;
}
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain:"afnsclub.firebaseapp.com",
  projectId:"afnsclub"
});
</script>
</head>

<body>

<div class="header">
  <div>
    <img src="logo.png"> Admin Control
  </div>
  <button onclick="logout()">Logout</button>
</div>

<div class="container">
  <h2>Players</h2>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Game ID</th>
        <th>Wins</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>

  <footer>
    AFNs Elite Striker |
    <a href="https://www.facebook.com/share/1CTCywTQAj/" target="_blank">
      SI Shohan
    </a>
  </footer>
</div>

<script>
const auth=firebase.auth();
const db=firebase.firestore();
const rows=document.getElementById("rows");

/* ===== AUTH PROTECT ===== */
auth.onAuthStateChanged(u=>{
  if(!u) location.href="admin-login.html";
});

/* ===== LOAD PLAYERS ===== */
db.collection("players").onSnapshot(snap=>{
  rows.innerHTML="";
  snap.forEach(doc=>{
    const d=doc.data();
    const tr=document.createElement("tr");

    let status="Active";
    if(d.banned){
      if(d.banUntil){
        const days=Math.max(
          0,
          Math.floor((d.banUntil.toDate()-new Date())/86400000)
        );
        status=`Banned (${days}d)`;
      }else status="Banned";
    }

    tr.innerHTML=`
      <td>${d.name||"Player"}</td>
      <td>${d.gameId||"—"}</td>
      <td>${d.wins||0}</td>
      <td>${status}</td>
      <td>
        ${
          d.banned
          ? `<button class="action unban" onclick="unban('${doc.id}')">Unban</button>`
          : `<button class="action ban" onclick="ban('${doc.id}')">Ban</button>`
        }
        <button class="action del" onclick="delPlayer('${doc.id}')">Delete</button>
      </td>
    `;
    rows.appendChild(tr);
  });
});

/* ===== ACTIONS ===== */
function ban(uid){
  const days=parseInt(prompt("Ban for how many days?", "3"));
  if(!days||days<=0) return;
  const until=new Date();
  until.setDate(until.getDate()+days);
  db.collection("players").doc(uid).update({
    banned:true,
    banUntil:firebase.firestore.Timestamp.fromDate(until)
  });
}

function unban(uid){
  if(!confirm("Unban this player?")) return;
  db.collection("players").doc(uid).update({
    banned:false,
    banUntil:null
  });
}

function delPlayer(uid){
  if(!confirm("DELETE player permanently?")) return;
  db.collection("players").doc(uid).delete();
}

function logout(){
  auth.signOut().then(()=>{
    location.href="admin-login.html";
  });
}
</script>

</body>
</html>
