<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AFNS Elite Strikers - Ranking</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{--gold:#FFD700;--silver:#C0C0C0;--bronze:#CD7F32;--dark:#020d1f;--card:#0c1b2a}
body{margin:0;background:linear-gradient(180deg,#010814,#021b33);font-family:Segoe UI;color:white;text-align:center;overflow-x:hidden}
h1{padding:20px;font-size:28px;letter-spacing:2px;text-shadow:0 0 15px rgba(255,215,0,.6)}
table{width:95%;margin:auto;border-collapse:collapse;margin-top:20px}
th{background:#061423;padding:15px;font-size:18px;text-transform:uppercase;letter-spacing:1px}
td{padding:14px;border-bottom:1px solid #112b45;font-weight:600}
tr{opacity:0;transform:translateY(20px);animation:fadeSlide .6s forwards}
@keyframes fadeSlide{to{opacity:1;transform:translateY(0)}}
tr:hover{background:#0f2c4d;transform:scale(1.01);transition:.2s}
.rank1{background:linear-gradient(90deg,#3a2e00,#1b1400);color:var(--gold);box-shadow:0 0 20px rgba(255,215,0,.6)}
.rank2{background:linear-gradient(90deg,#2a2a2a,#111);color:var(--silver);box-shadow:0 0 15px rgba(192,192,192,.6)}
.rank3{background:linear-gradient(90deg,#3b1f00,#1c0d00);color:var(--bronze);box-shadow:0 0 15px rgba(205,127,50,.6)}
.medal{font-size:20px;margin-right:5px}
.player-link{color:inherit;text-decoration:none;cursor:pointer;transition:.2s}
.player-link:hover{text-decoration:underline;color:#FFD700}
</style>
</head>
<body>
<h1>üèÜ AFNS Elite Strikers Federation Ranking</h1>
<table>
<thead>
<tr>
<th>Rank</th>
<th>Player</th>
<th>Win</th>
<th>Loss</th>
<th>Draw</th>
<th>Rating</th>
</tr>
</thead>
<tbody id="rankingBody"></tbody>
</table>

  <script>
firebase.initializeApp({
  apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain:"afnsclub.firebaseapp.com",
  projectId:"afnsclub"
});

const db = firebase.firestore();
const table = document.getElementById("rankingBody");

let mode = "season"; // season / alltime

function getSeasonIndex(month){
  if(month>=8) return 3;
  if(month>=4) return 2;
  return 1;
}

function getCurrentSeasonId(){
  const now = new Date();
  return now.getFullYear()+"-S"+getSeasonIndex(now.getMonth());
}

function loadRanking(){

  table.innerHTML="<tr><td colspan='6'>Loading...</td></tr>";

  const currentSeason = getCurrentSeasonId();

  let query = db.collection("players");

  if(mode==="season"){
    query = query
      .where("seasonId","==",currentSeason)
      .orderBy("ratingSeason","desc");
  }else{
    query = query.orderBy("ratingAllTime","desc");
  }

  query.onSnapshot(snapshot=>{
    table.innerHTML="";
    let rank=1;

    snapshot.forEach(doc=>{
      const p = doc.data();
      let className="", medal="";

      if(rank==1){className="rank1";medal="ü•á";}
      else if(rank==2){className="rank2";medal="ü•à";}
      else if(rank==3){className="rank3";medal="ü•â";}

      const ratingValue = mode==="season"
        ? (p.ratingSeason||0)
        : (p.ratingAllTime||0);

      table.innerHTML+=`
      <tr class="${className}" style="animation-delay:${rank*0.1}s">
        <td><span class="medal">${medal}</span>${rank}</td>
        <td>
          <a class="player-link" href="public-profile.html?id=${doc.id}">
            ${p.username||"-"}
          </a>
        </td>
        <td>${p.wins||0}</td>
        <td>${p.losses||0}</td>
        <td>${p.draws||0}</td>
        <td>${ratingValue}</td>
      </tr>`;

      rank++;
    });

    if(snapshot.empty){
      table.innerHTML="<tr><td colspan='6'>No players found</td></tr>";
    }

  });

}

/* Toggle Button UI */
const toggleBtn=document.createElement("button");
toggleBtn.innerText="Switch to All Time";
toggleBtn.style.marginTop="10px";
toggleBtn.style.padding="10px 20px";
toggleBtn.style.fontWeight="bold";
toggleBtn.style.cursor="pointer";

toggleBtn.onclick=function(){
  if(mode==="season"){
    mode="alltime";
    toggleBtn.innerText="Switch to Season";
  }else{
    mode="season";
    toggleBtn.innerText="Switch to All Time";
  }
  loadRanking();
};

document.body.insertBefore(toggleBtn,document.querySelector("table"));

loadRanking();
  </script>
      
</body>
</html>
