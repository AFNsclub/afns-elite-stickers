<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AFNS Elite Strikers - Rankings</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --bg-dark:#0a0f21;
  --card-bg:rgba(0,0,0,0.6);
  --neon-cyan:#00f7ff;
  --neon-pink:#ff44aa;
  --neon-yellow:#ffbb33;
  --text:#fff;
}

body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:#0a0f21;
  color:var(--text);
  text-align:center;
  overflow-x:hidden;
}

.fire-bg{
  position:fixed; top:0; left:50%; transform:translateX(-50%);
  width:300%; height:300%;
  background:radial-gradient(circle at center,#ff0077, #ff5500, transparent 70%);
  animation:flare 4s infinite; opacity:0.12; pointer-events:none; z-index:0;
}
@keyframes flare{0%{transform:translateX(-50%) scale(1);}50%{transform:translateX(-50%) scale(1.15);}100%{transform:translateX(-50%) scale(1);}}

.spark{position:absolute;width:4px;height:4px;background:var(--neon-yellow);border-radius:50%;opacity:0.8;pointer-events:none;animation:rise 2.5s linear infinite;}
@keyframes rise{0%{transform:translateY(0) scale(1);opacity:0.8;}100%{transform:translateY(-180px) scale(0.3);opacity:0;}}

.logo{width:120px;margin:20px auto;display:block;filter:drop-shadow(0 0 25px var(--neon-cyan));position:relative;z-index:2;}
h1{font-size:38px;margin:10px 0 10px;background:linear-gradient(45deg,#ff0000,#0055ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:900;position:relative;z-index:2;}

#searchBox, #seasonToggle{
  width:90%; max-width:400px; padding:10px 12px; margin:8px auto; border-radius:12px; border:none; font-size:16px; display:block;
}

#seasonToggle{background:var(--card-bg); color:var(--text); cursor:pointer;}

.table-container{width:95%;max-width:900px;margin:auto 0 50px;border-radius:15px;overflow-x:auto;box-shadow:0 0 35px rgba(0,255,255,0.25);position:relative;background:var(--card-bg);}
table{width:100%;border-collapse:collapse;}
th{padding:16px;font-size:16px;text-transform:uppercase;background:rgba(10,20,40,0.7);color:var(--neon-pink);text-shadow:0 0 5px var(--neon-pink);}
td{padding:14px;font-weight:600;border-bottom:1px solid rgba(255,255,255,0.1);}
tr{opacity:0;transform:translateY(15px);animation:fadeSlide .5s forwards;transition:0.3s;}
@keyframes fadeSlide{to{opacity:1;transform:translateY(0);}}
tr:hover{transform:scale(1.02);background:rgba(0,255,255,0.08);}

.rank1{background:linear-gradient(120deg,#FFD700,#ffdd55); color:#000; box-shadow:0 0 20px #FFD700;}
.rank2{background:linear-gradient(120deg,#C0C0C0,#e0e0e0); color:#000; box-shadow:0 0 15px #C0C0C0;}
.rank3{background:linear-gradient(120deg,#CD7F32,#e1a55c); color:#000; box-shadow:0 0 15px #CD7F32;}
.medal{font-size:18px;margin-right:5px;}

.player-link{color:inherit;text-decoration:none;transition:.2s;}
.player-link:hover{text-decoration:underline;color:var(--neon-yellow);}

.winloss-bar{display:flex;height:10px;border-radius:6px;overflow:hidden;margin-top:4px;}
.win-part{background:#4cff8f;flex:0;} .loss-part{background:#ff6b6b;flex:0;} .draw-part{background:#ffd700;flex:0;}

footer{text-align:center;font-size:14px;margin-bottom:20px;color:var(--neon-yellow);font-weight:700;text-shadow:0 0 8px var(--neon-cyan);}

@media(max-width:500px){
  th,td{font-size:13px;padding:10px;} 
  h1{font-size:28px;margin-bottom:15px;} 
  .logo{width:90px;}
}
</style>
</head>
<body>

<div class="fire-bg"></div>
<img src="logo.png" alt="AFNS Logo" class="logo">
<h1>üèÜ AFNS ELITE STRIKERS</h1>

<button id="seasonToggle">Seasonal Rankings</button>
<input type="text" id="searchBox" placeholder="Search player...">

<div class="table-container">
<table>
<thead>
<tr>
<th>Rank</th>
<th>Player</th>
<th>Wins</th>
<th>Losses</th>
<th>Draws</th>
<th>Rating</th>
</tr>
</thead>
<tbody id="rankingBody"></tbody>
</table>
</div>

<footer>¬© 2026 AFNS Elite Strikers | SI Shohan</footer>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain:"afnsclub.firebaseapp.com",
  projectId:"afnsclub"
});

const db=firebase.firestore();
const table=document.getElementById("rankingBody");
const searchBox=document.getElementById("searchBox");
const seasonToggle=document.getElementById("seasonToggle");

let allPlayers=[];
let showSeasonal=true;
let currentSeasonId=null;

/* Mini Sparks Generator */
function createSparks(num){
  for(let i=0;i<num;i++){
    const spark=document.createElement('div');
    spark.className='spark';
    spark.style.left=Math.random()*100+'%';
    spark.style.top=100+Math.random()*50+'%';
    spark.style.animationDuration=(1+Math.random()*2)+'s';
    document.body.appendChild(spark);
  }
}
createSparks(25);

/* LOAD CURRENT SEASON */
async function loadSeason(){
  const snap = await db.collection("seasons").where("active","==",true).limit(1).get();
  currentSeasonId = snap.docs[0]?.id || null;
  fetchPlayers();
}

seasonToggle.addEventListener("click",()=>{
  showSeasonal=!showSeasonal;
  seasonToggle.innerText=showSeasonal?"Seasonal Rankings":"All-time Rankings";
  fetchPlayers();
});

searchBox.addEventListener("input",()=>renderTable(allPlayers));

async function fetchPlayers(){
  let query = db.collection("players");
  if(showSeasonal && currentSeasonId) query=query.where("seasonId","==",currentSeasonId);
  query=query.orderBy("rating","desc");
  const snap = await query.get();
  allPlayers=[];
  snap.forEach(doc=>allPlayers.push({id:doc.id,...doc.data()}));
  renderTable(allPlayers);
}

function renderTable(players){
  const filter=searchBox.value.toLowerCase();
  table.innerHTML="";
  let rank=1;
  players.filter(p=>p.username.toLowerCase().includes(filter))
  .forEach(p=>{
    let className="",medal="";
    if(rank===1){className="rank1";medal="ü•á";}
    else if(rank===2){className="rank2";medal="ü•à";}
    else if(rank===3){className="rank3";medal="ü•â";}

    const total=p.wins+p.losses+p.draws||1;
    const winPercent=(p.wins/total)*100;
    const lossPercent=(p.losses/total)*100;
    const drawPercent=(p.draws/total)*100;

    table.innerHTML+=`<tr class="${className}" style="animation-delay:${rank*0.1}s">
      <td><span class="medal">${medal}</span>${rank}</td>
      <td><a class="player-link" href="public-profile.html?id=${p.id}">${p.username||"-"}</a>
        <div class="winloss-bar">
          <div class="win-part" style="flex:${winPercent}"></div>
          <div class="loss-part" style="flex:${lossPercent}"></div>
          <div class="draw-part" style="flex:${drawPercent}"></div>
        </div>
      </td>
      <td>${p.wins||0}</td>
      <td>${p.losses||0}</td>
      <td>${p.draws||0}</td>
      <td>${p.rating||0}</td>
    </tr>`;
    rank++;
  });
}

loadSeason();
</script>
</body>
</html>
