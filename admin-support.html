<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>AFN Admin Support Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --gold:#F5B94C;
  --blue:#4DB6FF;
  --bg:#0A1630;
  --dark:#05070A;
  --red:#E53935;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif}

body{
  height:100vh;
  background:linear-gradient(180deg,var(--bg),var(--dark));
  color:#fff;
  display:flex;
}

/* SIDEBAR */
.sidebar{
  width:90px;
  background:#020816;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:10px;
  gap:10px;
}

.ticket{
  width:100%;
  padding:8px;
  background:rgba(245,185,76,.15);
  border-radius:12px;
  text-align:center;
  font-size:12px;
  cursor:pointer;
}
.ticket.active{
  background:linear-gradient(145deg,var(--gold),#ffd86b);
  color:#000;
  font-weight:900;
}

/* CHAT AREA */
.main{
  flex:1;
  display:flex;
  flex-direction:column;
}

.header{
  padding:14px;
  background:linear-gradient(145deg,var(--gold),#ffd86b);
  color:#000;
  font-weight:900;
}

.chat{
  flex:1;
  padding:14px;
  overflow-y:auto;
}

.msg{
  max-width:75%;
  padding:12px;
  border-radius:16px;
  margin-bottom:10px;
  font-size:14px;
}

.user{
  background:linear-gradient(145deg,var(--blue),#1e90ff);
  color:#001;
}

.ai{
  background:rgba(255,255,255,.08);
  border-left:4px solid var(--gold);
}

.admin{
  background:linear-gradient(145deg,var(--gold),#ffd86b);
  color:#000;
  margin-left:auto;
  font-weight:700;
}

.input{
  display:flex;
  padding:12px;
  gap:10px;
  background:#020816;
}
.input input{
  flex:1;
  padding:12px;
  border-radius:12px;
  border:none;
}
.input button{
  background:linear-gradient(145deg,var(--blue),#1e90ff);
  border:none;
  border-radius:12px;
  padding:0 18px;
  font-weight:900;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar" id="users"></div>

<!-- MAIN -->
<div class="main">
  <div class="header">ðŸ‘‘ Admin Support Console</div>
  <div class="chat" id="chat"></div>
  <div class="input">
    <input id="reply" placeholder="Admin reply à¦²à¦¿à¦–à§à¦¨...">
    <button onclick="send()">SEND</button>
  </div>
</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain:"afnsclub.firebaseapp.com",
  projectId:"afnsclub"
});

const auth=firebase.auth();
const db=firebase.firestore();

let activeUID=null;

/* ADMIN AUTH CHECK */
auth.onAuthStateChanged(u=>{
  if(!u){location.href="admin-login.html";return;}
  loadUsers();
});

/* LOAD ESCALATED USERS */
function loadUsers(){
  db.collection("adminAlerts")
    .orderBy("time","desc")
    .onSnapshot(snap=>{
      users.innerHTML="";
      snap.forEach(d=>{
        const div=document.createElement("div");
        div.className="ticket";
        div.innerText=d.data().uid.slice(0,6);
        div.onclick=()=>openChat(d.data().uid,div);
        users.appendChild(div);
      });
    });
}

/* OPEN CHAT */
function openChat(uid,el){
  activeUID=uid;
  [...users.children].forEach(c=>c.classList.remove("active"));
  el.classList.add("active");

  db.collection("supportChats").doc(uid)
    .collection("messages")
    .orderBy("time")
    .onSnapshot(snap=>{
      chat.innerHTML="";
      snap.forEach(d=>render(d.data()));
      chat.scrollTop=chat.scrollHeight;
    });
}

/* RENDER */
function render(d){
  const div=document.createElement("div");
  div.className=`msg ${d.from}`;
  div.innerText=d.text;
  chat.appendChild(div);
}

/* SEND ADMIN REPLY */
function send(){
  const t=reply.value.trim();
  if(!t || !activeUID)return;
  reply.value="";

  db.collection("supportChats").doc(activeUID)
    .collection("messages").add({
      from:"admin",
      text:t,
      time:Date.now()
    });

  db.collection("adminAlerts").where("uid","==",activeUID)
    .get().then(s=>{
      s.forEach(d=>d.ref.update({status:"replied"}));
    });
}
</script>

</body>
</html>
