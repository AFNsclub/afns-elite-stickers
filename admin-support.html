<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Support Panel</title>
<meta name="viewport" content="width=device-width">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;background:#0b1025;color:#fff;font-family:system-ui}
.container{display:flex;height:100vh}
.users{width:35%;border-right:1px solid #1f2550;overflow:auto}
.chat{flex:1;display:flex;flex-direction:column}
.user{padding:10px;border-bottom:1px solid #1f2550;cursor:pointer}
.user.active{background:#1f2550}
.messages{flex:1;padding:10px;overflow:auto}
.msg{margin-bottom:8px;padding:8px 12px;border-radius:12px;max-width:70%}
.user-msg{background:#0d6efd;margin-left:auto}
.ai-msg{background:#2a2f55}
.admin-msg{background:#198754}
footer{display:flex;padding:10px}
input{flex:1;padding:10px;border-radius:20px;border:none}
button{margin-left:8px;border:none;padding:10px 16px;border-radius:20px;background:#0d6efd;color:#fff}
</style>
</head>

<body>
<div class="container">
  <div class="users" id="users"></div>
  <div class="chat">
    <div class="messages" id="messages"></div>
    <footer>
      <input id="reply" placeholder="Admin reply...">
      <button onclick="send()">Send</button>
    </footer>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey:"YOUR_KEY",
  authDomain:"YOUR_DOMAIN",
  projectId:"YOUR_PROJECT"
});
const db=firebase.firestore();
let current=null;

/* ðŸ” Auth check */
firebase.auth().onAuthStateChanged(u=>{
  if(!u) location.href="admin-login.html";
});

/* ðŸ“‹ Load chats */
db.collection("supportChats")
.orderBy("updated","desc")
.onSnapshot(s=>{
  users.innerHTML="";
  s.forEach(d=>{
    let div=document.createElement("div");
    div.className="user";
    div.innerText=d.id;
    div.onclick=()=>openChat(d.id);
    users.appendChild(div);
  });
});

function openChat(uid){
  current=uid;
  messages.innerHTML="";
  db.collection("supportChats").doc(uid)
  .collection("messages").orderBy("time")
  .onSnapshot(s=>{
    messages.innerHTML="";
    s.forEach(d=>{
      let m=d.data();
      let div=document.createElement("div");
      div.className="msg "+
        (m.from==="user"?"user-msg":m.from==="admin"?"admin-msg":"ai-msg");
      div.innerText=m.text;
      messages.appendChild(div);
    });
    messages.scrollTop=messages.scrollHeight;
  });
}

function send(){
  if(!current) return;
  let text=reply.value.trim();
  if(!text) return;
  reply.value="";
  db.collection("supportChats").doc(current)
  .collection("messages").add({
    text,
    from:"admin",
    time:Date.now()
  });
}
</script>
</body>
</html>
