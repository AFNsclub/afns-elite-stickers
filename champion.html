<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Champion Certificate</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  background:#0b1220;
  color:white;
  font-family:Arial;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.card{
  background:#111a2e;
  padding:28px;
  border-radius:14px;
  width:340px;
  text-align:center;
}
button{
  padding:14px;
  width:100%;
  border:none;
  border-radius:10px;
  background:#4f8cff;
  color:white;
  font-size:16px;
  margin-top:18px;
  cursor:pointer;
}
.hidden{display:none;}
</style>
</head>

<body>

<div class="card">
  <h2>üèÜ Champion Certificate</h2>
  <p id="statusText">Waiting for tournament result...</p>
  <h3 id="championName"></h3>

  <button id="pdfBtn" class="hidden" onclick="generatePDF()">
    Download Champion Certificate
  </button>
</div>

<script>
/* =========================
   üî• FIREBASE CONFIG
========================= */
firebase.initializeApp({
  apiKey: "AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain: "afnsclub.firebaseapp.com",
  projectId: "afnsclub",
  storageBucket: "afnsclub.firebasestorage.app",
  messagingSenderId: "1088089213558",
  appId: "1:1088089213558:web:bd5e01caaeecaa46bcad57"
});
const db = firebase.firestore();

/* =========================
   üñºÔ∏è CERTIFICATE ASSETS
========================= */
const LOGO_IMAGE_URL = "https://i.imgur.com/ssP9KMa.png";
const SIGNATURE_IMAGE_URL = "https://i.imgur.com/lQqjvC6.png";

/* =========================
   üî• LISTEN FOR CHAMPION
========================= */
let CHAMPION = "";

db.doc("tournaments/current").onSnapshot(doc=>{
  if(!doc.exists) return;

  const data = doc.data();
  if(data.status === "finished" && data.champion){
    CHAMPION = data.champion;
    document.getElementById("statusText").innerText = "Champion Declared üéâ";
    document.getElementById("championName").innerText = CHAMPION;
    document.getElementById("pdfBtn").classList.remove("hidden");
  }
});

/* =========================
   üìÑ PDF GENERATOR
========================= */
async function generatePDF(){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("landscape","px","a4");

  const loadImg = url => new Promise(res=>{
    const i = new Image();
    i.crossOrigin="anonymous";
    i.onload=()=>res(i);
    i.src=url;
  });

  const logo = await loadImg(LOGO_IMAGE_URL);
  const sign = await loadImg(SIGNATURE_IMAGE_URL);

  pdf.setFillColor(15,20,40);
  pdf.rect(0,0,842,595,"F");

  pdf.addImage(logo,"PNG",360,30,120,120);

  pdf.setTextColor(255,215,0);
  pdf.setFontSize(40);
  pdf.text("CHAMPION",421,200,{align:"center"});

  pdf.setFontSize(26);
  pdf.setTextColor(79,140,255);
  pdf.text(CHAMPION,421,260,{align:"center"});

  pdf.setFontSize(16);
  pdf.setTextColor(220,220,220);
  pdf.text(new Date().toDateString(),421,310,{align:"center"});

  pdf.addImage(sign,"PNG",620,390,120,60);
  pdf.text("Organizer",680,460,{align:"center"});

  pdf.save("Champion_Certificate.pdf");
}
</script>

</body>
</html>
