<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Match Control</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{background:#050b1e;color:white;font-family:Arial;margin:0;padding:20px}
.card{background:#0b1622;padding:14px;border-radius:10px;margin-bottom:12px}
button{padding:6px 10px;border:none;border-radius:8px;font-weight:bold;margin-right:6px}
.approve{background:#00eaff}
</style>
</head>
<body>

<h2>Match Control</h2>
<div id="list"></div>

<script>

firebase.initializeApp({
  apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain:"afnsclub.firebaseapp.com",
  projectId:"afnsclub"
});

const auth = firebase.auth();
const db = firebase.firestore();

auth.onAuthStateChanged(async user=>{
  if(!user){
    location.href="login.html";
    return;
  }

  const adminDoc = await db.collection("admins").doc(user.email).get();
  if(!adminDoc.exists || adminDoc.data().active !== true){
    alert("Admin only");
    location.href="login.html";
    return;
  }

  loadMatches();
});

async function loadMatches(){

  const list = document.getElementById("list");
  list.innerHTML="";

  const snap = await db.collection("matches")
    .orderBy("createdAt","desc")
    .get();

  if(snap.empty){
    list.innerHTML="No matches found";
    return;
  }

  snap.forEach(doc=>{
    const m = doc.data();

    const card=document.createElement("div");
    card.className="card";

    card.innerHTML=`
      <b>${m.playerName}</b> vs <b>${m.opponentName}</b><br>
      Score: ${m.score}<br>
      Status: ${m.status}<br><br>
      ${m.status==="pending"
        ? `<button class="approve" onclick="approveMatch('${doc.id}')">Approve</button>`
        : ""}
    `;

    list.appendChild(card);
  });
}

async function approveMatch(id){
  await db.collection("matches").doc(id).update({
    status:"approved",
    approvedAt:firebase.firestore.FieldValue.serverTimestamp()
  });
  loadMatches();
}

</script>
</body>
</html>
