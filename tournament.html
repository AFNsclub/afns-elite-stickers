<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ğŸ† Tournament Hub | AFNS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:Arial;background:radial-gradient(circle at top,#0a1a4a,#050b1e);color:white;padding:20px;}
.container{max-width:800px;margin:auto;}
h2{text-align:center;margin-bottom:15px;}
.stats{display:flex;justify-content:space-between;margin-bottom:15px;}
.stat{background:rgba(255,255,255,.05);padding:12px;border-radius:10px;text-align:center;flex:1;margin-right:10px;}
.stat:last-child{margin-right:0;}
.stat span{display:block;font-size:22px;font-weight:bold;color:#4f8cff;}
.button-link{text-decoration:none;display:block;background:#00c853;color:white;text-align:center;padding:12px;border-radius:8px;margin-bottom:10px;}
.statusBox{margin-top:15px;text-align:center;padding:10px;border-radius:8px;background:#555;}
</style>
</head>
<body>

<div class="container">
<h2 id="tournamentTitle">ğŸ† Tournament Hub</h2>

<div class="stats">
  <div class="stat"><span id="playersCount">0</span>Players</div>
  <div class="stat"><span id="matchesCount">0</span>Matches</div>
  <div class="stat"><span id="pendingMatches">0</span>Pending</div>
</div>

<a href="tournament-register.html" class="button-link">ğŸ“ Register for Tournament</a>
<a href="tournament-players.html" class="button-link">ğŸ‘¥ Registered Players</a>
<a href="my-matches.html" class="button-link">ğŸ® My Matches</a>

<div id="statusBox"></div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain:"afnsclub.firebaseapp.com",
  projectId:"afnsclub"
});
const auth = firebase.auth();
const db = firebase.firestore();

/* Login Check */
auth.onAuthStateChanged(async user=>{
  if(!user){alert("Login Required"); location.replace("login.html"); return;}
  await loadTournamentSettings();
  loadStats();
});

/* Tournament Settings */
async function loadTournamentSettings(){
  const snap = await db.collection("tournament_settings").doc("current").get();
  if(!snap.exists){document.getElementById("statusBox").innerText="Tournament Not Configured"; return;}
  const data = snap.data();
  document.getElementById("tournamentTitle").innerText = "ğŸ† " + (data.tournamentName || "Tournament Hub");

  const now = new Date();
  const deadline = data.registrationDeadline?.toDate();
  if(!data.active || (deadline && now > deadline)){
    document.getElementById("statusBox").innerHTML="Tournament Registration Closed";
  }
}

/* Live Stats */
function loadStats(){
  db.collection("tournament_registrations").onSnapshot(s=>{
    document.getElementById("playersCount").innerText = s.size;
  });
  db.collection("matches").onSnapshot(s=>{
    let total = s.size;
    let pending = s.docs.filter(d=>d.data().status==="pending").length;
    document.getElementById("matchesCount").innerText = total;
    document.getElementById("pendingMatches").innerText = pending;
  });
}
</script>

</body>
</html>
