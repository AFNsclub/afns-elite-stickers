<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Rankings & Legends</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
*{box-sizing:border-box;font-family:Segoe UI,Arial}
body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(circle at top,#0a1a4a,#050b1e);
  color:#fff;
}
.container{
  max-width:520px;
  margin:30px auto;
  padding:20px;
  background:rgba(255,255,255,.06);
  backdrop-filter:blur(12px);
  border-radius:20px;
  box-shadow:0 0 30px rgba(0,0,0,.6);
}
h2{text-align:center;margin:0}
.season{
  text-align:center;
  margin:8px 0 16px;
  font-size:13px;
  color:#a5b4fc;
}
.top3{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  margin-bottom:20px;
}
.champ{
  padding:14px;
  border-radius:16px;
  text-align:center;
  background:linear-gradient(145deg,#1e293b,#020617);
}
.champ img{
  width:54px;height:54px;
  border-radius:50%;
  border:2px solid #ffd700;
  margin-bottom:6px;
}
.gold{box-shadow:0 0 20px rgba(255,215,0,.6)}
.silver{box-shadow:0 0 16px rgba(192,192,192,.6)}
.bronze{box-shadow:0 0 14px rgba(205,127,50,.6)}
.rank-list .row{
  display:grid;
  grid-template-columns:36px 1fr 60px;
  gap:10px;
  align-items:center;
  padding:12px;
  border-radius:14px;
  background:rgba(255,255,255,.05);
  margin-bottom:8px;
  cursor:pointer;
  transition:.2s;
}
.row:hover{background:rgba(255,255,255,.1)}
.rank{font-weight:bold;text-align:center}
.name{font-size:14px}
.points{text-align:right;color:#a5b4fc;font-weight:700}
.actions{
  display:flex;
  justify-content:space-between;
  margin-top:16px;
}
.actions a{
  text-decoration:none;
  font-size:13px;
  color:#60a5fa;
  font-weight:700;
}
footer{
  text-align:center;
  font-size:12px;
  opacity:.6;
  margin-top:18px;
}
.badge{
  font-size:12px;
  margin-left:4px;
}
</style>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain:"afnsclub.firebaseapp.com",
  projectId:"afnsclub"
});
const db=firebase.firestore();

/* üî• STREAK BADGE LOGIC */
function getStreakBadge(streak){
  if(streak >= 5) return "üî• HOT";
  if(streak >= 3) return "‚ö°";
  return "";
}
</script>
</head>

<body>
<div class="container">
  <h2>üèÜ Rankings & Legends</h2>
  <div class="season" id="seasonText">Loading season...</div>

  <div class="top3" id="top3"></div>
  <div class="rank-list" id="list"></div>

  <div class="actions">
    <a href="hall-of-fame.html">üëë Hall of Fame</a>
    <a href="players.html">üîç All Players</a>
  </div>

  <footer>
    AFN's Elite Strikers<br>
    Play Smart ‚Ä¢ Stay Elite
  </footer>
</div>

<script>
async function getActiveSeason(){
  const snap = await db.collection("seasons")
    .where("active","==",true).limit(1).get();
  return snap.empty ? null : snap.docs[0].id;
}

(async()=>{
  const seasonId = await getActiveSeason();
  if(!seasonId) return;

  seasonText.textContent = `Season ${seasonId} ‚Ä¢ Live Ranking`;

  db.collection("players")
    .where("seasonId","==",seasonId)
    .onSnapshot(snap=>{
      let players=[];
      snap.forEach(d=>players.push({uid:d.id,...d.data()}));

      players.sort((a,b)=>{
        if((b.rating||0)!==(a.rating||0)) return (b.rating||0)-(a.rating||0);
        if((b.wins||0)!==(a.wins||0)) return (b.wins||0)-(a.wins||0);
        if((b.gd||0)!==(a.gd||0)) return (b.gd||0)-(a.gd||0);
        return (b.goals||0)-(a.goals||0);
      });

      render(players);
    });
})();

function render(players){
  top3.innerHTML="";
  list.innerHTML="";

  /* ü•á TOP 3 */
  players.slice(0,3).forEach((p,i)=>{
    const badge = getStreakBadge(p.winStreak || 0);

    const div=document.createElement("div");
    div.className=`champ ${["gold","silver","bronze"][i]}`;
    div.onclick=()=>location.href=`public-profile.html?uid=${p.uid}`;
    div.innerHTML=`
      <div>${["ü•á","ü•à","ü•â"][i]}</div>
      <img src="${p.photo||'avatar.png'}">
      <div>
        ${p.name||"Player"}
        ${badge ? `<span class="badge">${badge}</span>` : ""}
      </div>
      <small>${p.rating||0} RP</small>
    `;
    top3.appendChild(div);
  });

  /* üî¢ 4‚Äì10 RANK */
  players.slice(3,10).forEach((p,i)=>{
    const badge = getStreakBadge(p.winStreak || 0);

    const row=document.createElement("div");
    row.className="row";
    row.onclick=()=>location.href=`public-profile.html?uid=${p.uid}`;
    row.innerHTML=`
      <div class="rank">#${i+4}</div>
      <div class="name">
        ${p.name||"Player"}
        ${badge ? `<span class="badge">${badge}</span>` : ""}
      </div>
      <div class="points">${p.rating||0}</div>
    `;
    list.appendChild(row);
  });
}
</script>
</body>
</html>
