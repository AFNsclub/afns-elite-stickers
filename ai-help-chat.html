<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AI Help</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{background:#050b1e;color:#fff;font-family:Arial}
.chatbox{
  max-width:420px;
  margin:30px auto;
  background:#0b1622;
  border-radius:16px;
  padding:14px;
}
.msg{margin:6px 0;padding:8px 10px;border-radius:10px;font-size:14px}
.user{background:#4f8cff;text-align:right}
.ai{background:#222}
.admin{background:#ff4f4f}
input,button{
  width:100%;
  padding:10px;
  margin-top:10px;
  border:none;
  border-radius:10px;
}
button{background:#4f8cff;color:#fff;font-weight:bold}
.small{font-size:12px;opacity:.6}
</style>
</head>

<body>

<div class="chatbox">
  <h3>ü§ñ AI Help Desk</h3>
  <div id="chat"></div>

  <input id="text" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‚Ä¶">
  <button onclick="send()">Send</button>

  <button id="adminBtn" style="display:none;background:#ff4f4f"
    onclick="escalate()">üì© Contact Admin</button>

  <div class="small">AI ‡¶®‡¶æ ‡¶™‡¶æ‡¶∞‡¶≤‡ßá Admin ‡¶ú‡¶æ‡¶®‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá</div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain:"afnsclub.firebaseapp.com",
  projectId:"afnsclub"
});

const db=firebase.firestore();
let chatId=null;

/* SIMPLE AI BRAIN */
function aiReply(text){
  text=text.toLowerCase();

  if(text.includes("match"))
    return "üîß Match ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶≤‡ßá permission ‡¶è‡¶¨‡¶Ç season active ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®";

  if(text.includes("login"))
    return "üîê Login ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶≤‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ sign out ‡¶ï‡¶∞‡ßá try ‡¶ï‡¶∞‡ßÅ‡¶®";

  if(text.includes("permission"))
    return "üõ°Ô∏è ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ role ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ permission ‡¶®‡¶æ‡¶ì ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá";

  return null; // AI failed
}

function render(from,text){
  const d=document.createElement("div");
  d.className="msg "+from;
  d.innerText=text;
  chat.appendChild(d);
}

async function send(){
  if(!text.value) return;

  if(!chatId){
    const ref=await db.collection("help_chats").add({
      userId:"guest",
      userName:"Guest",
      messages:[],
      status:"ai",
      createdAt:firebase.firestore.FieldValue.serverTimestamp()
    });
    chatId=ref.id;
  }

  const userMsg=text.value;
  text.value="";

  render("user",userMsg);

  const ai=aiReply(userMsg);

  const msgs=[
    {from:"user",text:userMsg,time:new Date()}
  ];

  if(ai){
    render("ai",ai);
    msgs.push({from:"ai",text:ai,time:new Date()});
  }else{
    render("ai","ü§ñ ‡¶Ü‡¶Æ‡¶ø ‡¶™‡ßÅ‡¶∞‡ßã‡¶™‡ßÅ‡¶∞‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶®‡¶æ‚Ä¶");
    adminBtn.style.display="block";
  }

  await db.collection("help_chats").doc(chatId).update({
    messages:firebase.firestore.FieldValue.arrayUnion(...msgs),
    lastUpdate:firebase.firestore.FieldValue.serverTimestamp()
  });
}

async function escalate(){
  await db.collection("help_chats").doc(chatId).update({
    status:"escalated"
  });

  await db.collection("admin_notifications").add({
    type:"help_chat",
    chatId,
    message:"User needs admin help",
    seen:false,
    time:firebase.firestore.FieldValue.serverTimestamp()
  });

  adminBtn.style.display="none";
  render("admin","üì© Admin ‡¶ï‡ßá ‡¶ú‡¶æ‡¶®‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá");
}
</script>

</body>
</html>
