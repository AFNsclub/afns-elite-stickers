<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Match Submit | AFN's Elite Strikers</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#0b1220;
    color:white;
}
.container{
    max-width:400px;
    margin:60px auto;
    background:#141c2f;
    padding:20px;
    border-radius:12px;
}
h2{
    text-align:center;
    color:#00eaff;
}
label{
    display:block;
    margin-top:15px;
}
input,select,button{
    width:100%;
    padding:12px;
    margin-top:6px;
    border:none;
    border-radius:8px;
    font-size:16px;
}
input,select{
    background:#0b1220;
    color:white;
}
button{
    background:#00eaff;
    color:black;
    font-weight:bold;
    margin-top:20px;
    cursor:pointer;
}
</style>
</head>

<body>

<div class="container">
    <h2>Match Submit</h2>

    <label>Winner Username</label>
    <input type="text" id="winner" list="playerList" placeholder="Start typing...">

    <label>Loser Username</label>
    <input type="text" id="loser" list="playerList" placeholder="Start typing...">

    <datalist id="playerList"></datalist>

    <label>Score (Example: 5-3)</label>
    <input type="text" id="score" placeholder="5-3">

    <label>Match Type</label>
    <select id="matchType" onchange="toggleTournament()">
        <option value="friendly">Friendly</option>
        <option value="tournament">Tournament</option>
    </select>

    <div id="tournamentBox" style="display:none;">
        <label>Tournament Name</label>
        <input type="text" id="tournamentName" placeholder="Tournament name">

        <label>Winner Team Name</label>
        <input type="text" id="winnerTeam" placeholder="Winner team">

        <label>Loser Team Name</label>
        <input type="text" id="loserTeam" placeholder="Loser team">
    </div>

    <button onclick="submitMatch()">Submit Match</button>
</div>

<script>

firebase.initializeApp({
  apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain:"afnsclub.firebaseapp.com",
  projectId:"afnsclub"
});

const auth = firebase.auth();
const db = firebase.firestore();

/* ðŸ” LOGIN REQUIRED */
auth.onAuthStateChanged(user=>{
  if(!user){
    location.href="login.html";
  }else{
    loadPlayers();
  }
});

/* ðŸ”Ž LOAD PLAYERS */
async function loadPlayers(){
  const list = document.getElementById("playerList");
  const snap = await db.collection("players").get();
  snap.forEach(doc=>{
    const opt = document.createElement("option");
    opt.value = doc.data().username || doc.id;
    list.appendChild(opt);
  });
}

/* ðŸŽ® SHOW TOURNAMENT BOX */
function toggleTournament(){
  const type = document.getElementById("matchType").value;
  document.getElementById("tournamentBox").style.display =
      type==="tournament" ? "block" : "none";
}

/* ðŸš€ SUBMIT MATCH */
async function submitMatch(){

  const user = auth.currentUser;

  const winner = winner.value.trim();
  const loser = loser.value.trim();
  const score = score.value.trim();
  const type = matchType.value;
  const tournamentName = tournamentName.value.trim();
  const winnerTeam = winnerTeam.value.trim();
  const loserTeam = loserTeam.value.trim();

  if(!winner || !loser || !score){
    alert("Winner, Loser & Score required!");
    return;
  }

  if(type==="tournament" && !tournamentName){
    alert("Tournament name required!");
    return;
  }

  const now = new Date();
  const id = now.getFullYear()+"-"+
    String(now.getMonth()+1).padStart(2,"0")+"-"+
    String(now.getDate()).padStart(2,"0")+"_"+
    String(now.getHours()).padStart(2,"0")+"-"+
    String(now.getMinutes()).padStart(2,"0")+"-"+
    String(now.getSeconds()).padStart(2,"0");

  await db.collection("matches").doc(id).set({
    playerName:winner,
    opponentName:loser,
    score:score,
    matchType:type,
    tournamentName: type==="tournament" ? tournamentName : null,
    winnerTeam: winnerTeam || null,
    loserTeam: loserTeam || null,
    submittedBy:user.email,
    status:"pending",
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });

  alert("Match submitted! Waiting for admin approval.");
  location.reload();
}

</script>
</body>
</html>
