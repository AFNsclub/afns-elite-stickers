<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Submit Match</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{background:#0b1220;color:white;font-family:Arial;margin:0;padding:20px}
input,button{width:100%;padding:12px;margin-top:10px;border-radius:8px;border:none}
button{background:#00eaff;color:black;font-weight:bold}
</style>
</head>
<body>

<h2>Submit Match</h2>

<input type="text" id="opponent" placeholder="Opponent name">
<input type="text" id="score" placeholder="Score">
<button onclick="submitMatch()" id="submitBtn">Submit</button>

<script>

firebase.initializeApp({
  apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain:"afnsclub.firebaseapp.com",
  projectId:"afnsclub"
});

const auth = firebase.auth();
const db = firebase.firestore();

auth.onAuthStateChanged(user=>{
  if(!user){
    location.href="login.html";
  }
});

async function submitMatch(){

  const opponent = opponent.value.trim();
  const score = score.value.trim();
  const user = auth.currentUser;

  if(!opponent || !score){
    alert("All fields required");
    return;
  }

  const now = new Date();
  const id = now.getFullYear()+"-"+
    String(now.getMonth()+1).padStart(2,"0")+"-"+
    String(now.getDate()).padStart(2,"0")+"_"+
    String(now.getHours()).padStart(2,"0")+"-"+
    String(now.getMinutes()).padStart(2,"0")+"-"+
    String(now.getSeconds()).padStart(2,"0");

  document.getElementById("submitBtn").innerText="Submitting...";

  await db.collection("matches").doc(id).set({
    playerUid:user.uid,
    playerName:user.email,
    opponentName:opponent,
    score:score,
    status:"pending",
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });

  document.getElementById("submitBtn").innerText="Submitted âœ“";
}

</script>
</body>
</html>
