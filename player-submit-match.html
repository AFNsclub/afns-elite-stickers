<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Match Submit | AFN's Elite Strikers</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#0b1220;
    color:white;
}
.container{
    max-width:400px;
    margin:60px auto;
    background:#141c2f;
    padding:20px;
    border-radius:12px;
}
h2{
    text-align:center;
    color:#00eaff;
}
label{
    display:block;
    margin-top:15px;
}
input,button{
    width:100%;
    padding:12px;
    margin-top:6px;
    border:none;
    border-radius:8px;
    font-size:16px;
}
input{
    background:#0b1220;
    color:white;
}
button{
    background:#00eaff;
    color:black;
    font-weight:bold;
    margin-top:20px;
    cursor:pointer;
}
.note{
    font-size:13px;
    margin-top:10px;
    color:#aaa;
    text-align:center;
}
.logout{
    text-align:center;
    margin-top:15px;
}
.logout button{
    background:#ff4d4d;
    color:white;
}
</style>
</head>

<body>

<div class="container">
    <h2>Admin Match Submit</h2>

    <label>Winner Username</label>
    <input type="text" id="winner" placeholder="Winner username">

    <label>Loser Username</label>
    <input type="text" id="loser" placeholder="Loser username">

    <button onclick="submitMatch()">Submit Match</button>

    <div class="note">
        Admin only â€¢ Rating & Leaderboard auto update
    </div>

    <div class="logout">
        <button onclick="logout()">Logout</button>
    </div>
</div>

<script>

firebase.initializeApp({
  apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain:"afnsclub.firebaseapp.com",
  projectId:"afnsclub"
});

const auth = firebase.auth();
const db = firebase.firestore();

/* ðŸ” ADMIN GUARD */
auth.onAuthStateChanged(async user=>{
  if(!user){
    location.href="admin-login.html";
    return;
  }

  const snap = await db.collection("admins").doc(user.email).get();

  if(!snap.exists || snap.data().active !== true){
    alert("Access denied");
    location.href="admin-login.html";
  }
});

async function submitMatch(){

  const winner = document.getElementById("winner").value.trim();
  const loser = document.getElementById("loser").value.trim();

  if(!winner || !loser){
    alert("Both fields required!");
    return;
  }

  const now = new Date();
  const id = now.getFullYear()+"-"+
    String(now.getMonth()+1).padStart(2,"0")+"-"+
    String(now.getDate()).padStart(2,"0")+"_"+
    String(now.getHours()).padStart(2,"0")+"-"+
    String(now.getMinutes()).padStart(2,"0")+"-"+
    String(now.getSeconds()).padStart(2,"0");

  await db.collection("matches").doc(id).set({
    playerName:winner,
    opponentName:loser,
    score:"Admin Submit",
    status:"approved",
    approvedAt:firebase.firestore.FieldValue.serverTimestamp(),
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });

  alert("Match submitted!");
  document.getElementById("winner").value="";
  document.getElementById("loser").value="";
}

function logout(){
  auth.signOut();
}

</script>
</body>
</html>
