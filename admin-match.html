<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Match Verification</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#0b1220;
    color:white;
}
header{
    background:#111a2e;
    padding:15px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}
button{
    padding:8px 14px;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
.logout{background:#ff3b3b;color:white;}
.approve{background:#2ecc71;color:black;}
.reject{background:#e74c3c;color:white;}

.container{
    padding:15px;
}
.card{
    background:#151f36;
    padding:15px;
    border-radius:10px;
    margin-bottom:15px;
}
img{
    max-width:100%;
    border-radius:8px;
    margin-top:10px;
}
</style>
</head>

<body>

<!-- ðŸ” Admin Security -->
<script>
if(localStorage.getItem("adminLoggedIn")!=="true"){
    location.href="admin-login.html";
}
</script>

<header>
    <h3>Admin Match Verification</h3>
    <button class="logout" onclick="logout()">Logout</button>
</header>

<div class="container" id="matchList"></div>

<script>
let matches = JSON.parse(localStorage.getItem("pendingMatches")) || [];
let players = JSON.parse(localStorage.getItem("players")) || [];

function renderMatches(){
    const box=document.getElementById("matchList");
    box.innerHTML="";

    if(matches.length===0){
        box.innerHTML="<p>No pending matches</p>";
        return;
    }

    matches.forEach((m,i)=>{
        box.innerHTML+=`
        <div class="card">
            <h4>${m.player1} vs ${m.player2}</h4>
            <p>Winner: <b>${m.winner}</b></p>
            <img src="${m.screenshot}">
            <br><br>
            <button class="approve" onclick="approve(${i})">Approve</button>
            <button class="reject" onclick="reject(${i})">Reject</button>
        </div>
        `;
    });
}

function approve(index){
    let match=matches[index];

    updateRating(match.player1, match.player2, match.winner);

    let history=JSON.parse(localStorage.getItem("matchHistory"))||[];
    history.push(match);
    localStorage.setItem("matchHistory",JSON.stringify(history));

    matches.splice(index,1);
    localStorage.setItem("pendingMatches",JSON.stringify(matches));

    renderMatches();
    alert("Match Approved");
}

function reject(index){
    matches.splice(index,1);
    localStorage.setItem("pendingMatches",JSON.stringify(matches));
    renderMatches();
    alert("Match Rejected");
}

function updateRating(p1,p2,winner){
    let a=players.find(p=>p.username===p1);
    let b=players.find(p=>p.username===p2);

    if(!a||!b) return;

    if(winner===p1){
        a.rating+=10;
        b.rating-=5;
    }else{
        b.rating+=10;
        a.rating-=5;
    }

    localStorage.setItem("players",JSON.stringify(players));
}

function logout(){
    localStorage.removeItem("adminLoggedIn");
    location.href="admin-login.html";
}

renderMatches();
</script>

</body>
</html>
