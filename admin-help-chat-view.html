<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Help Chat</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{background:#050b1e;color:#fff;font-family:Arial;padding:20px}
.box{max-width:600px;margin:auto;background:#0b1622;padding:16px;border-radius:14px}
.msg{margin:6px 0;padding:8px;border-radius:10px}
.user{background:#4f8cff}
.ai{background:#222}
.admin{background:#ff4f4f}
</style>
</head>

<body>

<div class="box">
  <h3>ðŸ›  Help Chat</h3>
  <div id="chat"></div>

  <input id="reply" placeholder="Admin reply...">
  <button onclick="send()">Send</button>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain:"afnsclub.firebaseapp.com",
  projectId:"afnsclub"
});

const db=firebase.firestore();
const chatId=new URLSearchParams(location.search).get("id");

db.collection("help_chats").doc(chatId)
.onSnapshot(d=>{
  chat.innerHTML="";
  d.data().messages.forEach(m=>{
    const div=document.createElement("div");
    div.className="msg "+m.from;
    div.innerText=m.text;
    chat.appendChild(div);
  });
});

function send(){
  if(!reply.value) return;
  db.collection("help_chats").doc(chatId).update({
    messages: firebase.firestore.FieldValue.arrayUnion({
      from:"admin",
      text:reply.value,
      time:new Date()
    }),
    status:"closed"
  });
  reply.value="";
}
</script>

</body>
</html>
