<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>AFN Support Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --afn-gold:#F5B94C;
  --afn-neon:#4DB6FF;
  --afn-bg:#0A1630;
  --afn-dark:#05070A;
  --afn-red:#E53935;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif}

body{
  height:100vh;
  background:linear-gradient(180deg,var(--afn-bg),var(--afn-dark));
  display:flex;
  justify-content:center;
  align-items:center;
  color:#fff;
}

/* CHAT CONTAINER */
.chat-wrap{
  width:100%;
  max-width:430px;
  height:100vh;
  display:flex;
  flex-direction:column;
}

/* HEADER */
.chat-header{
  padding:14px;
  background:linear-gradient(145deg,var(--afn-gold),#ffcc70);
  color:#000;
  font-weight:900;
  display:flex;
  align-items:center;
  justify-content:space-between;
}

.chat-header span{
  font-size:13px;
  font-weight:700;
}

/* CHAT BODY */
.chat-body{
  flex:1;
  padding:14px;
  overflow-y:auto;
}

/* MESSAGE COMMON */
.msg{
  max-width:78%;
  padding:12px 14px;
  margin-bottom:10px;
  border-radius:18px;
  font-size:14px;
  line-height:1.4;
  animation:fadeIn .25s ease;
}

@keyframes fadeIn{
  from{opacity:0;transform:translateY(6px)}
  to{opacity:1;transform:none}
}

/* USER */
.user{
  background:linear-gradient(145deg,var(--afn-neon),#1e90ff);
  color:#001;
  margin-left:auto;
  border-bottom-right-radius:4px;
}

/* AI */
.ai{
  background:rgba(245,185,76,.15);
  border:1px solid var(--afn-gold);
  color:#fff;
  border-bottom-left-radius:4px;
}

/* ADMIN */
.admin{
  background:linear-gradient(145deg,var(--afn-gold),#ffd86b);
  color:#000;
  border-bottom-left-radius:4px;
  font-weight:700;
}

/* ESCALATED */
.escalated{
  border-left:4px solid var(--afn-red);
  background:rgba(229,57,53,.15);
}

/* INPUT */
.chat-input{
  padding:12px;
  display:flex;
  gap:10px;
  background:#020816;
}

.chat-input input{
  flex:1;
  padding:12px;
  border-radius:14px;
  border:none;
  outline:none;
}

.chat-input button{
  background:linear-gradient(145deg,var(--afn-neon),#1e90ff);
  border:none;
  border-radius:14px;
  padding:0 18px;
  font-weight:900;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="chat-wrap">

  <!-- HEADER -->
  <div class="chat-header">
    üí¨ AFN Support
    <span>AI + Admin Help</span>
  </div>

  <!-- BODY -->
  <div class="chat-body" id="chat"></div>

  <!-- INPUT -->
  <div class="chat-input">
    <input id="msg" placeholder="‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
    <button onclick="send()">‚û§</button>
  </div>

</div>

<script>
/* FIREBASE INIT */
firebase.initializeApp({
  apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain:"afnsclub.firebaseapp.com",
  projectId:"afnsclub"
});

const db = firebase.firestore();
const auth = firebase.auth();

let uid=null, escalated=false;

/* AUTH */
auth.onAuthStateChanged(u=>{
  if(!u){location.href="login.html";return;}
  uid=u.uid;
  loadMessages();
});

/* LOAD CHAT */
function loadMessages(){
  db.collection("supportChats").doc(uid)
    .collection("messages")
    .orderBy("time")
    .onSnapshot(snap=>{
      chat.innerHTML="";
      snap.forEach(d=>render(d.data()));
      chat.scrollTop=chat.scrollHeight;
    });
}

/* RENDER */
function render(d){
  const div=document.createElement("div");
  div.className=`msg ${d.from} ${d.escalated?'escalated':''}`;
  div.innerText=d.text;
  chat.appendChild(div);
}

/* SEND */
async function send(){
  const text=msg.value.trim();
  if(!text)return;
  msg.value="";

  await save("user",text);

  if(text.length>80 || text.includes("admin")){
    escalated=true;
    await save("ai","‡¶è‡¶á ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶ü‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®‡ßá‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶",true);
    notifyAdmin(text);
  }else{
    aiReply(text);
  }
}

/* SAVE */
function save(from,text,esc=false){
  return db.collection("supportChats").doc(uid)
    .collection("messages").add({
      from,text,escalated:esc,time:Date.now()
    });
}

/* AI REPLY (Placeholder ‚Äì API ready) */
function aiReply(t){
  let r="‡¶è‡¶á ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶¶‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡•§ ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
  if(t.includes("login")) r="‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶≤‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
  save("ai",r);
}

/* ADMIN NOTIFY */
function notifyAdmin(text){
  db.collection("adminAlerts").add({
    uid,
    text,
    time:Date.now(),
    status:"pending"
  });
}
</script>

</body>
</html>
