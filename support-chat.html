<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>AFN Support Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --gold:#f5c46c;
  --blue:#4db6ff;
  --bg:#050b14;
  --card:#0c1d2f;
}
*{box-sizing:border-box;font-family:Segoe UI}
body{margin:0;background:var(--bg);color:#fff}
header{
  background:linear-gradient(145deg,#091d30,#020a12);
  padding:14px;text-align:center;
  font-weight:900;color:var(--gold)
}
.chat{
  height:calc(100vh - 120px);
  overflow:auto;padding:14px
}
.msg{max-width:80%;padding:10px 14px;border-radius:16px;margin-bottom:10px}
.user{background:#1e3a5f;margin-left:auto}
.ai{background:#132e24;border-left:3px solid #00e676}
.admin{background:#2a1a1a;border-left:3px solid #ff5252}
footer{
  display:flex;gap:8px;padding:10px;
  background:#020a12
}
input{
  flex:1;padding:12px;border-radius:12px;border:none
}
button{
  padding:12px 18px;border:none;border-radius:12px;
  background:var(--blue);font-weight:900
}
.escalate{
  background:#ff5252;margin-left:6px
}
</style>
</head>

<body>
<header>ðŸ¤– AFN AI Support</header>

<div class="chat" id="chat"></div>

<footer>
  <input id="msg" placeholder="Type your problem...">
  <button onclick="send()">Send</button>
  <button class="escalate" onclick="needAdmin()">Admin</button>
</footer>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyBtDxu0LJyb10ZkhH8IpxT5s8PcKc4nUxM",
  authDomain:"afnsclub.firebaseapp.com",
  projectId:"afnsclub"
});
const auth=firebase.auth(),db=firebase.firestore();
let uid=null;

auth.onAuthStateChanged(u=>{
  if(!u){location.href="login.html";return;}
  uid=u.uid;
  listen();
});

function listen(){
  db.collection("supportChats").doc(uid)
   .collection("messages").orderBy("time")
   .onSnapshot(s=>{
     chat.innerHTML="";
     s.forEach(d=>{
       const m=d.data();
       const div=document.createElement("div");
       div.className="msg "+m.from;
       div.innerText=m.text;
       chat.appendChild(div);
     });
     chat.scrollTop=chat.scrollHeight;
   });
}

async function send(){
  const t=msg.value.trim();
  if(!t) return;
  msg.value="";
  await db.collection("supportChats").doc(uid)
    .collection("messages").add({
      from:"user",text:t,time:Date.now()
    });

  // AI placeholder (Cloud Function will answer)
}

function needAdmin(){
  db.collection("adminAlerts").add({
    uid,reason:"User requested admin",
    time:Date.now(),status:"open"
  });
  alert("âœ… Admin notified");
}
</script>
</body>
</html>
